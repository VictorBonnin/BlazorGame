@page "/newadventure"

<div class="page container-narrow">

  @if (!started && !finished)
  {
    <div class="card p-5 text-center">
      <h2 class="display-5 page-title"><span class="die">🎲</span> Nouvelle aventure</h2>
      <p class="lead">Prêt·e à explorer le donjon&nbsp;?</p>

      @if (!string.IsNullOrEmpty(error))
      {
        <div class="alert alert-info mt-3">
          Oups… <strong>@error</strong>
        </div>
      }

      <button class="btn btn-primary btn-lg mt-3" @onclick="StartAdventure" disabled="@(loading)">
        @(loading ? "Chargement..." : "Commencer")
      </button>
    </div>
  }

<!-- Écran de jeu -->
@if (started)
{
  <div class="card p-4 game-panel">
    <div class="d-flex justify-content-between align-items-center">
      <div>
        <div class="hud-label">Salle</div>
        <div class="hud-value">@((current + 1)) / @(rooms?.Count ?? 0)</div>
      </div>
      <div class="text-end">
        <div class="hud-label">Score</div>
        <div class="hud-value hud">⭐ @score</div>
      </div>
    </div>

    <div class="progress-xeno mt-3">
      <div class="bar" style="width:@Progress();"></div>
    </div>

    <div class="mt-4">
      <h3 class="game-section-title">Que faites-vous ?</h3>
      <div class="btn-group flex-wrap">
        <button class="btn btn-success btn-lg"   @onclick="ChooseCombattre">⚔️ Combattre</button>
        <button class="btn btn-secondary btn-lg" @onclick="ChooseFuir">🏃‍♂️ Fuir</button>
        <button class="btn btn-warning btn-lg"   @onclick="ChooseFouiller">🧭 Fouiller</button>
      </div>
      <div class="hint-text mt-3">
        Astuce&nbsp;: certains choix valent plus de points 😉
      </div>
    </div>
  </div>
}

  @if (finished)
  {
    <div class="card p-5 text-center">
      <h2 class="display-5">🎉 Aventure terminée</h2>
      <p class="lead">Votre score final&nbsp;: <strong>⭐ @score</strong></p>

      <div class="mt-3">
        <NavLink class="btn btn-outline-primary me-2" href="/leaderboard">Voir le classement</NavLink>
        <button class="btn btn-primary" @onclick="StartAdventure">Rejouer</button>
      </div>
    </div>
  }

</div>

@code {
  string Progress()
  {
    var total = rooms?.Count ?? 0;
    if (total <= 0) return "0%";
    var pct = (int)((current * 100.0) / total);
    return $"{pct}%";
  }

  void ChooseCombattre() => Choose("combattre");
  void ChooseFuir()       => Choose("fuir");
  void ChooseFouiller()   => Choose("fouiller");
}

